<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Track Team Manager - Idle Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    header {
      background: #333;
      color: #fff;
      padding: 1em;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 1em;
    }
    .section {
      background: #fff;
      margin: 10px 0;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    h2 {
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    .event {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }
    .event span {
      flex: 1;
    }
    button {
      padding: 5px 10px;
      border: none;
      background: #28a745;
      color: #fff;
      border-radius: 3px;
      cursor: pointer;
      margin-left: 10px;
    }
    button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    pre {
      background: #eee;
      padding: 10px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <header>
    <h1>Track Team Manager</h1>
    <p>Manage your team, train your athletes, and compete in track events!</p>
  </header>
  <div class="container">
    <!-- Team Funds and Passive Income -->
    <div class="section" id="teamStats">
      <h2>Team Stats</h2>
      <p id="funds">Funds: $100</p>
      <p>Passive Income: +$1 per second</p>
    </div>
    
    <!-- Training Section -->
    <div class="section" id="training">
      <h2>Training</h2>
      <div id="trainingList">
        <!-- Training events will be dynamically inserted here -->
      </div>
    </div>
    
    <!-- Competition Section -->
    <div class="section" id="competition">
      <h2>Competition</h2>
      <div id="competitionList">
        <!-- Competition preview will be dynamically inserted here -->
      </div>
      <button id="competeButton">Run Competition</button>
      <pre id="competitionResult">Competition results will appear here.</pre>
    </div>
  </div>
  
  <script>
    // Converts seconds into a mm:ss.xx format.
    function formatTime(totalSeconds) {
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      const secondsStr = seconds < 10 ? '0' + seconds.toFixed(2) : seconds.toFixed(2);
      return (minutes < 10 ? '0' + minutes : minutes) + ':' + secondsStr;
    }
    
    // Starting funds and passive income.
    let funds = 100;
    const passiveIncome = 1; // funds earned per second
    
    // Define our track events.
    // Improvement: 0.01 sec per 100m per level.
    // The predicted time is: baseTime - (trainingLevel × improvement)
    // and worldRecord is the target (and initial record) for that event.
    const events = [
      { 
        name: '100m',  
        distance: 100,  
        trainingLevel: 0, 
        baseTime: 15.0, 
        improvement: 0.01 * (100/100), // 0.01 sec per level 
        worldRecord: 9.48 
      },
      { 
        name: '200m',  
        distance: 200,  
        trainingLevel: 0, 
        baseTime: 40.0, 
        improvement: 0.01 * (200/100), // 0.02 sec per level 
        worldRecord: 18.99 
      },
      { 
        name: '400m',  
        distance: 400,  
        trainingLevel: 0, 
        baseTime: 90.0, // 1:30.00 
        improvement: 0.01 * (400/100), // 0.04 sec per level 
        worldRecord: 42.63 
      },
      { 
        name: '800m',  
        distance: 800,  
        trainingLevel: 0, 
        baseTime: 190.0, // 3:10.00 
        improvement: 0.01 * (800/100), // 0.08 sec per level 
        worldRecord: 100.11 // 1:40.11 
      },
      { 
        name: '1600m', 
        distance: 1600, 
        trainingLevel: 0, 
        baseTime: 390.0, // 6:30.00 
        improvement: 0.01 * (1600/100), // 0.16 sec per level 
        worldRecord: 220.24 // 3:40.24 
      },
      { 
        name: '3200m', 
        distance: 3200, 
        trainingLevel: 0, 
        baseTime: 790.0, // 13:10.00 
        improvement: 0.01 * (3200/100), // 0.32 sec per level 
        worldRecord: 470.90 // 7:50.90 
      }
    ];
    
    // Training cost increases with level.
    function trainingCost(event) {
      return 50 * (event.trainingLevel + 1);
    }
    
    // Update the training list UI.
    function updateTrainingList() {
      const trainingList = document.getElementById('trainingList');
      trainingList.innerHTML = '';
      events.forEach((event, index) => {
        const div = document.createElement('div');
        div.className = 'event';
        div.innerHTML = `
          <span><strong>${event.name}</strong> (Level: ${event.trainingLevel})</span>
          <span>Cost: $${trainingCost(event)}</span>
          <button onclick="trainEvent(${index})">Train</button>
        `;
        trainingList.appendChild(div);
      });
    }
    
    // Handle training: subtract funds and increase the event's training level.
    function trainEvent(index) {
      const event = events[index];
      const cost = trainingCost(event);
      if (funds >= cost) {
        funds -= cost;
        event.trainingLevel++;
        updateUI();
      } else {
        alert("Not enough funds!");
      }
    }
    
    // Update the competition preview list UI.
    function updateCompetitionList() {
      const competitionList = document.getElementById('competitionList');
      competitionList.innerHTML = '';
      events.forEach(event => {
        // Calculate predicted time (no clamping—world record may be broken).
        const predictedTime = event.baseTime - event.trainingLevel * event.improvement;
        const div = document.createElement('div');
        div.className = 'event';
        div.innerHTML = `<span>${event.name}: Predicted Time: ${formatTime(predictedTime)} | World Record: ${formatTime(event.worldRecord)}</span>`;
        competitionList.appendChild(div);
      });
    }
    
    // Simulate the competition.
    // A random variation of ±10% is applied to each event.
    function runCompetition() {
      let totalReward = 0;
      let resultText = '';
      events.forEach(event => {
        const predictedTime = event.baseTime - event.trainingLevel * event.improvement;
        // Variation between 0.9 and 1.1 (±10%)
        const variation = 1 + (Math.random() - 0.5) / 5;
        const performance = predictedTime * variation;
        let reward = 0;
        // Check for world record: if performance beats (is lower than) the current record.
        let recordBroken = false;
        if (performance < event.worldRecord) {
          recordBroken = true;
          // Update world record to this new performance.
          event.worldRecord = performance;
        }
        // Reward logic: if performance is at or better than predicted, you win.
        if (performance <= predictedTime) {
          reward = Math.round(100 * (event.distance / 100));
          resultText += `${event.name}: WIN! Time: ${formatTime(performance)} — Reward: $${reward}\n`;
        } else {
          reward = Math.round(50 * (event.distance / 100));
          resultText += `${event.name}: Loss. Time: ${formatTime(performance)} — Consolation: $${reward}\n`;
        }
        if (recordBroken) {
          resultText += `*** WORLD RECORD BROKEN in ${event.name}! New Record: ${formatTime(performance)} ***\n`;
        }
        totalReward += reward;
      });
      funds += totalReward;
      document.getElementById('competitionResult').innerText = resultText;
      updateUI();
    }
    
    // Update all UI elements.
    function updateUI() {
      document.getElementById('funds').innerText = `Funds: $${funds}`;
      updateTrainingList();
      updateCompetitionList();
    }
    
    // Increase funds passively every second.
    setInterval(() => {
      funds += passiveIncome;
      updateUI();
    }, 1000);
    
    // Attach competition button click handler.
    document.getElementById('competeButton').addEventListener('click', runCompetition);
    
    // Initial UI update.
    updateUI();
  </script>
</body>
</html>
